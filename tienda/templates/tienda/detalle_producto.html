{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'tienda/css/detalle_producto.css' %}">
    <link rel="stylesheet" href="{% static 'tienda/css/' %}{{ producto.vendedor.slug }}.css">

    <title>{{ producto.nombre }} | {{ producto.vendedor.nombre_tienda }}</title>
</head>

<body class="bg-light">
    <div class="container mt-5">
        <a href="{% url 'productos_emprendedor' producto.vendedor.id %}" class="btn btn-outline-secondary mb-4">⬅ Volver
            a la tienda</a>

        <div class="row bg-white p-4 shadow-sm rounded">
            <div class="col-md-6 text-center">
                {% if producto.imagen %}
                <img src="{{ producto.imagen.url }}" id="grande" class="img-fluid main-img w-100"
                    style="transition: opacity 0.3s ease; height: 400px; object-fit: contain; border-radius: 15px; background-color: #d5d4d4;">
                {% endif %}

                <div class="mt-3 d-flex justify-content-center align-items-center gap-2">
                    <button class="btn btn-sm btn-dark" onclick="cambiar(-1)">❮</button>

                    {% if producto.imagen %}
                    <img src="{{ producto.imagen.url }}" class="thumb active"
                        onclick="seleccionar('{{ producto.imagen.url }}', this)"
                        style="width: 60px; height: 60px; object-fit: cover; cursor: pointer; border-radius: 5px; border: 2px solid #000;">
                    {% endif %}

                    {% for extra in producto.imagenes_extras.all %}
                    <img src="{{ extra.imagen.url }}" class="thumb"
                        onclick="seleccionar('{{ extra.imagen.url }}', this)"
                        style="width: 60px; height: 60px; object-fit: cover; cursor: pointer; border-radius: 5px;">
                    {% endfor %}

                    <button class="btn btn-sm btn-dark" onclick="cambiar(1)">❯</button>
                </div>
            </div>

            <div class="col-md-6">
                <h1 class="display-5">{{ producto.nombre }}</h1>
                <p class="text-muted">Publicado por: {{ producto.vendedor.nombre_tienda }}</p>
                <hr>
                
                {% if not es_servicio %}
                    <h2 class="text-success">${{ producto.precio }}</h2>
                {% else %}
                    <h2 class="text-info">Servicio Profesional</h2>
                {% endif %}

                <div class="mt-4" style="color: #212529 !important;">
                    {{ producto.descripcion|linebreaks }}
                </div>

                {% if not es_servicio %}
                    <p class="badge bg-primary">Stock disponible: {{ producto.stock }}</p>
                {% endif %}

                <a href="https://wa.me/{{ producto.vendedor.telefono }}?text=Hola%20{{ producto.vendedor.nombre_tienda }}!%20Me%20interesa%20{% if es_servicio %}un presupuesto por el servicio{% else %}el producto{% endif %}:%20{{ producto.nombre }}" 
                target="_blank" 
                style="border-radius: 20px "
                class="btn btn-success w-100 mt-3 py-3 shadow fw-bold">
                    {% if es_servicio %}
                        Solicitar Presupuesto ahora
                    {% else %}
                        Consultar por WhatsApp ahora
                    {% endif %}
                </a>
            </div>
        </div>

        <div class="mt-5 mb-5">
            <h3>También te puede interesar...</h3>
            <div class="row">
                {% for s in sugerencias %}
                <div class="col-6 col-md-3 mt-3">
                    <div class="card h-100 shadow-sm border-0">
                        <a href="{% url 'detalle_producto' s.id %}">
                            {% if s.imagen %}
                            <img src="{{ s.imagen.url }}" class="card-img-top"
                                style="height: 150px; object-fit: cover;">
                            {% endif %}
                        </a>
                        <div class="card-body p-2 text-center">
                            <p class="small mb-0">{{ s.nombre }}</p>
                            {% if not es_servicio %}
                                <p class="fw-bold text-success">${{ s.precio }}</p>
                            {% else %}
                                <p class="small text-info">Ver servicio</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% empty %}
                <p class="text-muted ms-3">No hay más similares por ahora.</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <script src="{% static 'tienda/js/galeria.js' %}"></script>
    <script>
        const imagenesDesdeDjango = [];
        {% if producto.imagen %}
        imagenesDesdeDjango.push("{{ producto.imagen.url }}");
        {% endif %}
        {% for extra in producto.imagenes_extras.all %}
        imagenesDesdeDjango.push("{{ extra.imagen.url }}");
        {% endfor %}
        if (typeof inicializarGaleria === 'function') {
            inicializarGaleria(imagenesDesdeDjango);
        } else {
            console.error("Error: No se pudo cargar galeria.js. Revisa la ruta en static.");
        }
    </script>
</body>
</html>